name: CodeQLcustom

on:
  push: { branches: [ main, CodeQL-email-header ] }
  pull_request: { branches: [ main ] }
  workflow_dispatch:
    inputs:
      run_standard:
        description: "Run standard CodeQL (built-in suites)"
        type: boolean
        default: true
        required: false
      run_custom:
        description: "Run custom Email Header Injection pack"
        type: boolean
        default: true
        required: false
      scope_email_only:
        description: "Restrict DB to services/email_service.py (faster demo)"
        type: boolean
        default: false
        required: false

permissions:
  contents: read
  security-events: write
  actions: read

jobs:
  codeql-analysis:
    name: CodeQL Analysis
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4

      - name: Initialize CodeQL
        uses: github/codeql-action/init@v3
        with:
          # Run both Python and Go to catch all vulnerabilities
          languages: python,go
          # Use only security queries
          queries: security-extended

      - uses: github/codeql-action/autobuild@v3

      - name: Analyze
        uses: github/codeql-action/analyze@v3
